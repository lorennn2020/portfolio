var bubbleFocusFlag = true;function right_bar_ready() {jQuery.ajaxTransport("+script", function(s) {if (s.crossDomain) {var script,head = document.head || document.getElementsByTagName("head")[0] || document.documentElement;return {send: function(_, callback) {script = document.createElement("script");script.async = "async";if (s.scriptCharset) {script.charset = s.scriptCharset;}script.src = s.url;script.onload = function(_, isAbort) {if (isAbort || !script.readyState || /loaded|complete/.test(script.readyState)) {script.onload = null;if (head && script.parentNode) {head.removeChild(script);}script = undefined;if (!isAbort) {callback(200, "success");}}};script.onerror = function(e) {script.onerror = script.onload = null;if (head && script.parentNode) {head.removeChild(script);}script = undefined;callback(500, "error");};head.insertBefore(script, head.firstChild);},abort: function() {if (script) {script.onload(0, 1);}}};}});setData();var ckValCount = bubbleGetCookie('bubble');if (typeof(ckValCount) == 'undefined') {ckValCount = "0_0_0_0_0_0_0_0";}setBubbleNumber(ckValCount, false);setTimeout("getBubbleCount(true)", 1000);var myWindow = window;var ieWindow = document;if (self != top) {myWindow = top;ieWindow = top.document;}$(myWindow).bind("focus", function(event) {bubbleFocusFlag = true;}).bind("blur", function(event) {bubbleFocusFlag = false;});$(ieWindow).bind("focusin", function(event) {bubbleFocusFlag = true;}).bind("focusout", function(event) {bubbleFocusFlag = false;});}function getBubble() {var outputStr = '';outputStr += '    <li id="bubwho_li"><a href="#" class="browser" title="看過我的公司" onclick="getReadContent(7,10);gcn(\'_read\');return false;"><div class="bubble" id="bub_who" style="display:none;"></div></a>';outputStr += '                     <ul class="global_sub">';outputStr += '                           <li>';outputStr += '                             <div class="box alertbar_browser">';outputStr += '                                 <span id="bub_whoContent"></span><div id="hidden_bub_who" style="display:none;">0</div>';outputStr += '                                   <P><a href="#" onclick="sendToMy104(19,0);return false;" class="more">顯示所有資訊</a></P>';outputStr += '                            </div>';outputStr += '                           </li>';outputStr += '                        </ul>';outputStr += '      </li>';outputStr += '                 <li id="bubmail_li"><a href="#" class="letter" title="通知我的公司" onclick="getReadContent(8,8);gcn(\'_letter\');return false;"><div class="bubble" id="bub_mail" style="display:none;"></div></a>';outputStr += '                     <ul class="global_sub">';outputStr += '                           <li>';outputStr += '                             <div class="box alertbar_letter">';outputStr += '                                 <span id="bub_mailContent"></span><div id="hidden_bub_mail" style="display:none;">0</div>';outputStr += '                                   <P><a href="#" onclick="sendToMy104(20,0);return false;" class="more">顯示所有資訊</a></P>';outputStr += '                               </div>';outputStr += '                           </li>';outputStr += '                     </ul>';outputStr += '                   </li>';outputStr += '                   <li id="bubjobs_li"><a href="#" class="newjob" title="配對工作" onclick="getMyMatchData();gcn(\'_newjob\');return false;"><div class="bubble" id="bub_jobs" style="display:none;"></div></a>';outputStr += '                     <ul class="global_sub">';outputStr += '                           <li>';outputStr += '                             <div class="box alertbar_newjob">';outputStr += '                                 <span id="bub_matchContent"></span><div id="hidden_bub_jobs" style="display:none;">0_0_0_0_0</div>';outputStr += '                                   <p><a href="#" onclick="sendToMy104(14,0);return false;" class="more">顯示所有資訊</a></p>';outputStr += '                               </div>';outputStr += '                           </li>';outputStr += '                        </ul>';outputStr += '                   </li>';return outputStr;}function getNameBlock() {var outputStr = '';outputStr += '<li class="personal"><a id="name_link" href="#" title="名字" onclick="gcn(\'_id\');return false;"><p id="myName"></p><span></span></a> ';outputStr += '    <ul class="global_sub">                                                                                 ';outputStr += '        <li>                                                                                                ';outputStr += '            <div class="personal_box box">                                                                  ';outputStr += '            <dl class="myfamilychannel">                                                                    ';outputStr += '            <dt><a href="//pda.104.com.tw" onclick="gcn(\'_sso2\');" target="_blank">My104會員中心</a></dt>';outputStr += '            <dt id="myfalmilyTitle" style="display:none;">我的家族頻道</dt>                                ';outputStr += '            <dt><a href="//www.104.com.tw/faq" onclick="gcn(\'_ask\');" onclick="gcn(\'_QA\');" target="_blank">常見問題</a></dt>';outputStr += '            <dt><a href="//www.104.com.tw/feedback" target="_blank">意見回饋</a></dt>';outputStr += '            </dl>                                                                                           ';outputStr += '            </div>                                                                                          ';outputStr += '        </li>                                                                                               ';outputStr += '    </ul>                                                                                                   ';outputStr += '</li>                                                                                                       ';outputStr += '<li><a href="//login.104.com.tw/logout" onclick="gcn(\'_logout\');">登出</a></li>                      ';return outputStr;}function getBubbleCount(allowCk) {var div_arr = new Array('bub_104', 'bub_who', 'bub_mail', 'bub_jobs');var old = "";var ckValCount = bubbleGetCookie('bubble');if (typeof(ckValCount) == 'undefined') {ckValCount = "0_0_0_0_0_0_0_0";}if (!bubbleFocusFlag) {setBubbleNumber(ckValCount, false);setTimeout("getBubbleCount(true)", 1000);return;}if (allowCk && ckValCount.length > 0) {old = ckValCount;setBubbleNumber(old, false);}else {var hidden_count = new Array();hidden_count[0] = ($("#hidden_" + div_arr[3]).html()) ? ($("#hidden_" + div_arr[3]).html()) : ("0_0_0_0_0");hidden_count[1] = ($("#hidden_" + div_arr[0]).html()) ? ($("#hidden_" + div_arr[0]).html()) : ("0");hidden_count[2] = ($("#hidden_" + div_arr[1]).html()) ? ($("#hidden_" + div_arr[1]).html()) : ("0");hidden_count[3] = ($("#hidden_" + div_arr[2]).html()) ? ($("#hidden_" + div_arr[2]).html()) : ("0");old = hidden_count.join('_');}var _url = "//bubble.104.com.tw/data/GetBubbleCount";var _data = 'read_from=1&old=' + old;$.ajax({url: _url,data: _data,dataType: "jsonp",success: function(obj) {setBubbleNumber(obj.unread, true);setTimeout("getBubbleCount(false)", 1000);},error: function(xhr, ajaxOptions, thrownError) {setTimeout("getBubbleCount(false)", 10000);},complete: function() {}});}function setBubbleNumber(unread, isAjax) {var div_arr = new Array('bub_104', 'bub_who', 'bub_mail', 'bub_jobs');var img_arr = new Array('bub104_li', 'bubwho_li', 'bubmail_li', 'bubjobs_li');var hiddenJobNums = "";var intCount = new Array(3);intCount[0] = 0;intCount[1] = 0;intCount[2] = 0;intCount[3] = 0;if (typeof(unread) == "string") {var unreadNumList = unread.split("_");if (unreadNumList.length == 8) {if (isAjax) {bubbleSetCookie('bubble', unread, 3600, '/');}for (var i = 0;i < 5;i++) {hiddenJobNums += unreadNumList[i] + '_';intCount[3] += parseInt(unreadNumList[i]);}hiddenJobNums = hiddenJobNums.substring(0, hiddenJobNums.length - 1);if (hiddenJobNums != $("#hidden_bub_jobs").html()) {if ($('#bubjobs_li').hasClass('active')) {for (var i = 1;i < 6;i++) {$('#matchcount' + i).html(unreadNumList[i - 1]);if (unreadNumList[i - 1] < 1) {$('#li_newjob' + i).removeClass("no");}}}}intCount[0] = parseInt(unreadNumList[5]);intCount[1] = parseInt(unreadNumList[6]);intCount[2] = parseInt(unreadNumList[7]);}}for (var i = 0;i < intCount.length;i++) {if (intCount[i] == 0) {$("#" + img_arr[i]).removeClass("yell_notice");$("#" + div_arr[i]).hide();$("#" + div_arr[i]).html(intCount[i]);}else {$("#" + img_arr[i]).addClass("yell_notice");$("#" + div_arr[i]).show();if (intCount[i] > maxCount) {$("#" + div_arr[i]).html(maxCount.toString() + "+");}else {$("#" + div_arr[i]).html(intCount[i]);}}if (i == 3) {newjob_flag = (hiddenJobNums != $("#hidden_bub_jobs").html()) ? (false) : (newjob_flag);}else {bubble_flag[i + 6] = (intCount[i] != $("#hidden_" + div_arr[i]).html()) ? (false) : (bubble_flag[i + 6]);}$("#hidden_" + div_arr[i]).html((i == 3) ? (hiddenJobNums) : (intCount[i]));}}function getReadContent(item, showcount) {if (!bubble_flag[item]) {var _url = "//bubble.104.com.tw/data/GetBubbleContent";var _data = "read_from=1&type=" + item;$.ajax({url: _url,data: _data,dataType: "jsonp",success: function(obj) {var showContent = "";var bubID = "";var spanID = "";switch (parseInt(item)) {case 6: spanID = "bub_104Content";bubID = "bub_104";liID = "bub104_li";break;case 7: spanID = "bub_whoContent";bubID = "bub_who";liID = "bubwho_li";break;case 8: spanID = "bub_mailContent";bubID = "bub_mail";liID = "bubmail_li";break;}if (typeof(obj) == "object") {var lastReadTime = c_v(obj.LastReadTime, "string", "");var contentLen = obj.BubbleContent.length;var bub_content = "";var bub_inputdate = "";var bub_custno = "";var bub_custname = "";var noread = "";var url_para = "";var bub_msgno = "";var today = new Date();var d = today.getDate();var m = today.getMonth() + 1;var y = today.getFullYear();var todayStr = '' + y + '-' + (m <= 9 ? '0' + m : m) + '-' + (d <= 9 ? '0' + d : d);var isToday = true;var isNoRead = true;var showDateTime = "";for (i = 0;i < contentLen && i < showcount;i++) {bub_content = c_v(obj.BubbleContent[i].bub_content, "string", "");bub_inputdate = c_v(obj.BubbleContent[i].bub_inputdate, "string", "");bub_custno = c_v(obj.BubbleContent[i].bub_custno, "string", "");bub_custname = c_v(obj.BubbleContent[i].bub_custname, "string", "");bub_contenttype = c_v(obj.BubbleContent[i].bub_contenttype, "string", "0");bub_msgno = c_v(obj.BubbleContent[i].bub_msgno, "string", "0");bub_cmasterid = c_v(obj.BubbleContent[i].bub_cmasterid, "string", "0");bub_jobno = c_v(obj.BubbleContent[i].bub_jobno, "string", "0");bub_jobname = c_v(obj.BubbleContent[i].bub_jobname, "string", "");if (isNoRead && cmpTime(bub_inputdate, lastReadTime) < 1) {isNoRead = false;}if (isToday && todayStr != bub_inputdate.substring(0, 10)) {isToday = false;}noread = (isNoRead) ? ("no") : ("");showDateTime = (isToday) ? (bub_inputdate.substring(11, 16)) : (bub_inputdate.substring(5, 10));if (bub_content != "") {switch (item) {case 6: showContent = showContent + '<li onclick="sendToMy104(56,' + bub_msgno + ');" class="li_alert ' + noread + '"><a href="javascript:void(0)" title="' + bub_content + '">' + bub_content + '</a><samp>（' + showDateTime + '）</samp></li>';break;case 7: url_para = globalbar_included + "_readlayer";var urllink = '//www.104.com.tw/jobbank/custjob/index.php?r=cust&j=' + bub_custno + '&frombar=' + url_para;showContent = showContent + '<li onclick="javascript:window.open(\'' + urllink + '\', \'_blank\');" class="li_who ' + noread + '"><a href="javascript:void(0)" title="' + bub_content + '">' + bub_content + '</a><samp>（' + showDateTime + '）</samp></li>';break;case 8: var forwardID = 72;showContent = showContent + '<dl onclick="sendToMy104(' + forwardID + ',\'' + bub_jobno + '\');" class="li_mail ' + noread + '"><dt><a href="javascript:void(0)">' + bub_custname + '&nbsp;/&nbsp;' + bub_jobname + '</a><samp>（' + showDateTime + '）</samp></dt><dd>' +replaceSpecialWord(bub_content) + '</dd></dl>';break;}}}}if (showContent != "") {switch (parseInt(item)) {case 6:showContent = "<h3>104提醒</h3><ul>" + showContent + "</ul>";break;case 7:showContent = "<h3>看過我的公司</h3><ul>" + showContent + "</ul>";break;case 8:showContent = "<h3>通知我的公司</h3>" + showContent;break;}}else {switch (item) {case 6:showContent = "<h3>104提醒</h3><P>無最新資料</P>";break;case 7:showContent = "<h3>看過我的公司</h3><P>無最新資料</P>";break;case 8:showContent = "<h3>通知我的公司</h3><P>無最新資料</P>";break;}}bubble_flag[item] = true;$("#" + spanID).html(showContent);setTimeout(function() {clearBgcolor(item)}, 3000);},error: function(xhr, ajaxOptions, thrownError) {setTimeout("getReadContent(item,showcount)", 1000);}});}}function getMyMatchData() {if (true) {var _url = "//bubble.104.com.tw/data/GetNewjobContent";var _data = "read_from=1";$.ajax({url: _url,data: _data,dataType: "jsonp",success: function(obj) {var showContent = "";if (typeof(obj) == "undefined" || typeof(obj.MatchjobContent) == "undefined" ||obj.MatchjobContent.length == 0) {showContent = "<h3>配對工作</h3><ul>";showContent = showContent + '<center>無設定配對條件</center>';}else {var match_name = "";var match_count = "";var read_time = "";var itemno = 0;var unclass = "";var objLen = obj.MatchjobContent.length;var unreadCountList = $("#hidden_bub_jobs").html().split("_");var match_time = c_v(obj.match_time, "string", "");showContent = "<h3><span>" + match_time.substring(11, 16) + " 更新</span>配對工作</h3><ul>";for (var i = 0;i < objLen;i++) {match_name = c_v(obj.MatchjobContent[i].match_name, "string", "");match_name = match_name.replace(/</g, "&lt;");match_name = match_name.replace(/>/g, "&gt;");read_time = c_v(obj.MatchjobContent[i].read_time, "string", "");itemno = c_v(obj.MatchjobContent[i].itemno, "number", 0);sno = c_v(obj.MatchjobContent[i].sno, "string", "0");match_count = unreadCountList[itemno - 1];unclass = "";if (match_count > 0) {unclass = 'class="no"';}showContent = showContent + '<li ' + unclass + ' id="li_newjob' + itemno + '" onclick="getMatchContent(' + itemno + ',\'' + sno + '\');sendToMatchList(' + itemno + ',\'' + sno + '\');return false;">' + match_name + '，最新<a href="#" class="amount"><p id="matchcount' + itemno + '">' + match_count + '</p></a>筆';if (read_time.length > 0) {var today = new Date();var d = today.getDate();var m = today.getMonth() + 1;var y = today.getFullYear();var todayStr = '' + y + '-' + (m <= 9 ? '0' + m : m) + '-' + (d <= 9 ? '0' + d : d);showDateTime = (todayStr == read_time.substring(0, 10)) ? (read_time.substring(11, 16)) : (read_time.substring(5, 10));showContent = showContent + '<samp>（<span id="readtime' + itemno + '">' + showDateTime + '</span>）</samp></li>';}else {showContent = showContent + '</li>';}}}showContent = showContent + '</ul>';$("#bub_matchContent").html(showContent);newjob_flag = true;},error: function(xhr, ajaxOptions, thrownError) {setTimeout("getMyMatchData()", 1000);}});}}function getMatchContent(item, sno) {if (isNaN(item) || typeof(sno) != 'string') {return;}var _url = "//bubble.104.com.tw/data/SendJobReaded";var _data = "item=" + item + "&sno=" + sno;$.ajax({url: _url,data: _data,dataType: "jsonp",success: function(readTime) {if (typeof(readTime) == 'string' && readTime.length > 0) {var showDateTime = readTime.substring(11, 16);if ($('#readtime' + item).length > 0) {$('#readtime' + item).html(showDateTime);}else {$('#li_newjob' + item).append('<samp>（<span id="readtime' + item + '">' + showDateTime + '</span>）</samp>');}}},error: function(xhr, ajaxOptions, thrownError) {setTimeout("getMatchContent(item, sno)", 1000);}});}function setData() {var obj = {"fname":"林伊珞","FamilyContent":[],"surveyKey":"2000000022831920221117"};var strName = obj.fname;if (strName != '') {$("#myName").html(funsubstr(strName, 12, 0));$("#name_link").attr("title", strName);}}function clearBgcolor(item) {switch (item) {case 6:$(".alertbar_notice li").removeClass("no");break;case 7:$(".alertbar_browser li").removeClass("no");break;case 8:$(".alertbar_letter dl").removeClass("no");break;}}function sendToMatchList(itemno, sno) {gcn('_newjoblayer' + itemno );url = '//pda.104.com.tw' + '/work/mate/list/' + sno;window.open(url, '_blank')
}